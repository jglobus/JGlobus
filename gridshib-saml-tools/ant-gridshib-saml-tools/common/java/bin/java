#!/bin/sh

## shamelessly copied from the Globus bin directory:
updateOptions() {
  if [ "X$2" != "X" ] ; then
    LOCAL_OPTS="$LOCAL_OPTS -D$1=$2"
  fi
}

## the JDK installation directory
if [ ! -n "$JAVA_HOME" ] ; then
  echo "Error: JAVA_HOME is not defined."
  exit 1
fi

if [ ! -n "$JAVACMD" ] ; then
  JAVACMD=$JAVA_HOME/bin/java
fi

if [ ! -x "$JAVACMD" ] ; then
  echo "Error: JAVA_HOME is not defined correctly."
  echo "Cannot execute $JAVACMD"
  exit 1
fi

## the GridShib installation directory
if [ ! -n "$GRIDSHIB_HOME" ] ; then
  echo "Error: GRIDSHIB_HOME is not defined."
  exit 1
fi

updateOptions "gridshib.home" "$GRIDSHIB_HOME"
updateOptions "java.endorsed.dirs" "$GRIDSHIB_HOME/endorsed"
updateOptions "log4j.configuration" "$GRIDSHIB_HOME/etc/log4j.properties"
updateOptions "org.globus.gridshib.config" "$GRIDSHIB_CONFIG"

## initialize the local classpath
if [ -n "$CLASSPATH" ] ; then
  LOCAL_CLASSPATH=$CLASSPATH
fi

## add jar files to the local classpath
DIRLIBS=${GRIDSHIB_HOME}/lib/*.jar
for i in ${DIRLIBS}
do
  # if the directory is empty, then it will return the input string
  # this is stupid, so case for it
  if [ "$i" != "${DIRLIBS}" ] ; then
    if [ -z "$LOCAL_CLASSPATH" ] ; then
      LOCAL_CLASSPATH=$i
    else
      LOCAL_CLASSPATH="$i":$LOCAL_CLASSPATH
    fi
  fi
done

## add servlet jar to the local classpath, if possible
if [ ! -n "$CATALINA_HOME" ] ; then
  ## "Warning: CATALINA_HOME is not defined."
  :
else
  ## the servlet jar
  SERVLET_JAR=$CATALINA_HOME/common/lib/servlet-api.jar
  ## add servlet jar to the local classpath
  LOCAL_CLASSPATH=$LOCAL_CLASSPATH:"$SERVLET_JAR"
fi

## run java
$JAVACMD $LOCAL_OPTS -cp $LOCAL_CLASSPATH "$@"
