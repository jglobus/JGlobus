<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>

  <head>

    <title>GridShib SAML Tools: User Guide</title>

    <!-- indexing information for search engines -->
    <meta name="author" lang="en-us" content="Tom Scavo">
    <meta name="copyright" lang="en-us" content="&copy; 2005&ndash;2008 University of Illinois">
    <meta name="keywords" lang="en-us" content="GridShib, SAML, user, guide">
    <meta name="description" lang="en-us" content="User Guide for GridShib SAML Tools">

    <!-- server response header entries -->
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
    <meta http-equiv="Content-Script-Type" content="text/javascript">
    <meta http-equiv="Content-Style-Type" content="text/css">

    <!-- global style sheets -->
    <link rel="stylesheet" type="text/css" href="styles/main.css" media="all">
    <link rel="stylesheet" type="text/css" href="styles/print.css" media="print">

  </head>

  <body>

    <script type="text/javascript" src="scripts/navbar.js"></script>

    <h1>
      GridShib SAML Tools<br>
    </h1>

    <p>This is the user guide for <strong>GridShib SAML Tools</strong>.  See the <a href="readme.html">readme</a> document for more information about GridShib, the GridShib SAML Tools, and other GridShib software components.</p>

    <p>GridShib is licensed under the Apache License, Version&nbsp;2.0.  Please review the licensing terms of the <a href="LICENSE.txt">GridShib License</a> before using this software.  Additional licensing information will be found on the <a href="http://gridshib.globus.org/download.html">GridShib Downloads</a> page.</p>

    <p><strong>Contents</strong></p>

    <ol>
      <li><a href="#getting_started">Getting Started</a></li>
      <li><a href="#using_saml_extraction_tool">Using the SAML Assertion Extraction Tool</a></li>
      <li><a href="#using_saml_info_tool">Using the SAML Security Info Tool</a></li>
      <li>
        <a href="#using_x509_binding_tool">Using the X.509 Binding Tool</a>
        <ol>
          <li><a href="#configuring_binding_tool">Configuring the Binding Tool</a></li>
        </ol>
      </li>
      <li>
        <a href="#using_saml_issuer_tool">Using the SAML Assertion Issuer Tool</a>
        <ol>
          <li><a href="#issuing_holder-of-key">Issuing <code>holder-of-key</code> SAML assertions</a></li>
          <li><a href="#issuing_sender-vouches">Issuing <code>sender-vouches</code> SAML assertions</a></li>
          <li><a href="#configuring_issuer_tool">Configuring the Issuer Tool</a></li>
        </ol>
      </li>
      <li><a href="#using_saml_verify_tool">Using the SAML Assertion Verify Tool</a></li>
      <li>
        <a href="#configuring_saml_tools">Configuring the SAML Tools</a>
        <ol>
          <li><a href="#configuring_x509_credential">Configuring the X.509 issuing credential</a></li>
          <li><a href="#configuring_saml_issuer">Configuring an identifier for the SAML issuer</a></li>
          <li><a href="#configuring_saml_nameid">Configuring the SAML name identifier</a></li>
          <li><a href="#configuring_datetime_pattern">Configuring the dateTime pattern</a></li>
          <li><a href="#configuring_saml_attributes">Configuring SAML attributes</a></li>
          <li><a href="#configuring_on_the_fly">Configuring the SAML Tools on the command line</a></li>
          <li><a href="#configuring_x509_cred_on_the_fly">Configuring the X.509 issuing credential on the command line</a></li>
        </ol>
      </li>
      <li><a href="#limitations">Known Limitations</a></li>
    </ol>

    <h2><a name="getting_started">Getting Started</a></h2>

    <p>The GridShib SAML Tools include several command-line tools:</p>

    <ol>
      <li><em>SAML Assertion Extraction Tool</em></li>
      <li><em>SAML Security Info Tool</em></li>
      <li><em>X.509 Binding Tool</em></li>
      <li><em>SAML Assertion Issuer Tool</em></li>
      <li><em>SAML Assertion Verify Tool</em></li>
    </ol>

    <p>The command-line options used by the SAML Tools are summarized in the following table:</p>

    <table>
      <tr>
        <th>Long Option</th>
        <th>Short Option</th>
        <th>Extraction<br>Tool</th>
        <th>Info<br>Tool</th>
        <th>Binding<br>Tool</th>
        <th>Issuer<br>Tool</th>
        <th>Verify<br>Tool</th>
        <th>See</th>
        <th>Since</th>
      </tr>
      <tr>
        <td class="command-line-option">--infile</td>
        <td class="command-line-option">-f</td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="java-classname">BaseCLI</td>
        <td class="version-number">0.3</td>
      </tr>
      <tr>
        <td class="command-line-option">--outfile</td>
        <td class="command-line-option">-o</td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="java-classname">BaseCLI</td>
        <td class="version-number">0.1</td>
      </tr>
      <tr>
        <td class="command-line-option">--debug</td>
        <td class="command-line-option">-d</td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="java-classname">BaseCLI</td>
        <td class="version-number">0.1</td>
      </tr>
      <tr>
        <td class="command-line-option">--quiet</td>
        <td class="command-line-option">-q</td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="java-classname">BaseCLI</td>
        <td class="version-number">0.1</td>
      </tr>
      <tr>
        <td class="command-line-option">--help</td>
        <td class="command-line-option">-h</td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="java-classname">BaseCLI</td>
        <td class="version-number">0.1</td>
      </tr>
      <tr>
        <td class="command-line-option">--verbose</td>
        <td class="command-line-option">-v</td>
        <td class="unsupported-option"></td>
        <td class="optional-option"></td>
        <td class="unsupported-option"></td>
        <td class="unsupported-option"></td>
        <td class="unsupported-option"></td>
        <td class="java-classname">InfoToolCLI</td>
        <td class="version-number">0.5</td>
      </tr>
      <tr>
        <td class="command-line-option">--extract</td>
        <td class="command-line-option">-e</td>
        <td class="unsupported-option"></td>
        <td class="optional-option"></td>
        <td class="unsupported-option"></td>
        <td class="unsupported-option"></td>
        <td class="unsupported-option"></td>
        <td class="java-classname">InfoToolCLI</td>
        <td class="version-number">0.5</td>
      </tr>
      <tr>
        <td class="command-line-option">--config</td>
        <td class="command-line-option">-F</td>
        <td class="unsupported-option"></td>
        <td class="unsupported-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="java-classname">CommonCLI</td>
        <td class="version-number">0.1</td>
      </tr>
      <tr>
        <td class="command-line-option">--x509</td>
        <td class="command-line-option">-X</td>
        <td class="unsupported-option"></td>
        <td class="unsupported-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="java-classname">CommonCLI</td>
        <td class="version-number">0.1</td>
      </tr>
      <tr>
        <td class="command-line-option">--x509Lifetime</td>
        <td class="command-line-option">-E</td>
        <td class="unsupported-option"></td>
        <td class="unsupported-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="java-classname">CommonCLI</td>
        <td class="version-number">0.1</td>
      </tr>
      <tr>
        <td class="command-line-option">--asn1</td>
        <td class="command-line-option">-A</td>
        <td class="unsupported-option"></td>
        <td class="unsupported-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="java-classname">CommonCLI</td>
        <td class="version-number">0.3</td>
      </tr>
      <tr>
        <td class="command-line-option">--saml</td>
        <td class="command-line-option">-S</td>
        <td class="unsupported-option"></td>
        <td class="unsupported-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="java-classname">CommonCLI</td>
        <td class="version-number">0.3</td>
      </tr>
      <tr>
        <td class="command-line-option">--properties</td>
        <td class="command-line-option">-D</td>
        <td class="unsupported-option"></td>
        <td class="unsupported-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="java-classname">CommonCLI</td>
        <td class="version-number">0.3</td>
      </tr>
      <tr>
        <td class="command-line-option">--certPath</td>
        <td class="command-line-option">-c</td>
        <td class="unsupported-option"></td>
        <td class="unsupported-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="java-classname">CommonCLI</td>
        <td class="version-number">0.5</td>
      </tr>
      <tr>
        <td class="command-line-option">--keyPath</td>
        <td class="command-line-option">-k</td>
        <td class="unsupported-option"></td>
        <td class="unsupported-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="java-classname">CommonCLI</td>
        <td class="version-number">0.5</td>
      </tr>
      <tr>
        <td class="command-line-option">--oid</td>
        <td class="command-line-option">-O</td>
        <td class="unsupported-option"></td>
        <td class="unsupported-option"></td>
        <td class="required-option"></td>
        <td class="unsupported-option"></td>
        <td class="unsupported-option"></td>
        <td class="java-classname">X509ToolCLI</td>
        <td class="version-number">0.3</td>
      </tr>
      <tr>
        <td class="command-line-option">--holder-of-key</td>
        <td class="command-line-option">-K</td>
        <td class="unsupported-option"></td>
        <td class="unsupported-option"></td>
        <td class="unsupported-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="java-classname">SAMLBasicCLI</td>
        <td class="version-number">0.3</td>
      </tr>
      <tr>
        <td class="command-line-option">--user</td>
        <td class="command-line-option">-u</td>
        <td class="unsupported-option"></td>
        <td class="unsupported-option"></td>
        <td class="unsupported-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="java-classname">SAMLBasicCLI</td>
        <td class="version-number">0.1</td>
      </tr>
      <tr>
        <td class="command-line-option">--sender-vouches</td>
        <td class="command-line-option">-V</td>
        <td class="unsupported-option"></td>
        <td class="unsupported-option"></td>
        <td class="unsupported-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="java-classname">SAMLBasicCLI</td>
        <td class="version-number">0.3</td>
      </tr>
      <tr>
        <td class="command-line-option">--lifetime</td>
        <td class="command-line-option">-e</td>
        <td class="unsupported-option"></td>
        <td class="unsupported-option"></td>
        <td class="unsupported-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="java-classname">SAMLToolCLI</td>
        <td class="version-number">0.1</td>
      </tr>
      <tr>
        <td class="command-line-option">--authn</td>
        <td class="command-line-option">-a</td>
        <td class="unsupported-option"></td>
        <td class="unsupported-option"></td>
        <td class="unsupported-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="java-classname">SAMLToolCLI</td>
        <td class="version-number">0.1</td>
      </tr>
      <tr>
        <td class="command-line-option">--authnMethod</td>
        <td class="command-line-option">-M</td>
        <td class="unsupported-option"></td>
        <td class="unsupported-option"></td>
        <td class="unsupported-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="java-classname">SAMLToolCLI</td>
        <td class="version-number">0.1</td>
      </tr>
      <tr>
        <td class="command-line-option">--authnInstant</td>
        <td class="command-line-option">-I</td>
        <td class="unsupported-option"></td>
        <td class="unsupported-option"></td>
        <td class="unsupported-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="java-classname">SAMLToolCLI</td>
        <td class="version-number">0.1</td>
      </tr>
      <tr>
        <td class="command-line-option">--address</td>
        <td class="command-line-option">-i</td>
        <td class="unsupported-option"></td>
        <td class="unsupported-option"></td>
        <td class="unsupported-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="java-classname">SAMLToolCLI</td>
        <td class="version-number">0.1</td>
      </tr>
      <tr>
        <td class="command-line-option">--ssoResponse</td>
        <td class="command-line-option">-R</td>
        <td class="unsupported-option"></td>
        <td class="unsupported-option"></td>
        <td class="unsupported-option"></td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="java-classname">SAMLToolCLI</td>
        <td class="version-number">0.1</td>
      </tr>
      <tr style="border-top: solid black">
        <td colspan="9" style="border-top: solid black; text-align: center">
          Required: <span style="background-color: red">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> Optional: <span style="background-color: gray">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
        </td>
      </tr>
    </table>

    <p>To use any of the command-line scripts below, an environment variable is required.  For example:</p>

<pre>  UNIX:
  $ <strong>export GRIDSHIB_HOME=/usr/local/gridshib-saml-tools-X_X_X</strong></pre>

<pre>  Windows:
  &gt; <strong>set GRIDSHIB_HOME=c:\gridshib\gridshib-saml-tools-X_X_X</strong></pre>

    <p>The <code>GRIDSHIB_HOME</code> environment variable is set to the absolute path of the installation directory.</p>

    <p>Recall that a <em>bootstrap properties</em> file is configured at install time (see the <a href="install.html#configuration">configuration</a> section of the install notes).  That bootstrap properties file is loaded for every command invocation of the GridShib SAML Tools.  To specify a different bootstrap properties file, set the <code>GRIDSHIB_CONFIG</code> environment variable:</p>

<pre>  UNIX:
  <span style="font-size: smaller">$ <strong>export GRIDSHIB_CONFIG=$GRIDSHIB_HOME/etc/gridshib-bootstrap.properties</strong></span></pre>

<pre>  Windows:
  <span style="font-size: smaller">&gt; <strong>set GRIDSHIB_CONFIG=%GRIDSHIB_HOME%\etc\gridshib-bootstrap.properties</strong></span></pre>

    <p>The above bootstrap properties file is distributed with GridShib SAML Tools as a sample only.  It is functionally equivalent to the default bootstrap properties file.</p>

    <blockquote><div style="font-style: italic"><strong>Note:</strong> The following commands use the short-lived test credentials created by the installer.  You may have to periodically rerun the installer <span style="font-style: normal">(or simply type: <code>ant test-cli</code>)</span> to refresh the credentials since the Tools will not process expired credentials.  Better yet, <a href="#configuring_x509_credential">configure the SAML Tools to use a longer-lived issuing credential</a>.</div></blockquote>

    <h2><a name="using_saml_extraction_tool">Using the SAML Assertion Extraction Tool</a></h2>

    <p>The <em>SAML Assertion Extraction Tool</em> is a simple utility that takes a Globus credential as input, extracts the SAML assertion from the last certificate in the proxy certificate chain (if any), and displays the result on standard output (by default).  The Extraction Tool is invoked as follows:</p>

<pre>  UNIX:
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-saml-extract --help</strong></pre>

<pre>  Windows:
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-saml-extract --help</strong></pre>

<pre>  Description: Outputs the SAML assertion bound to the specified credential

  usage: gridshib-saml-extract [--help | [--infile &lt;path&gt;] [--outfile &lt;path&gt;]
                               [--debug] [--quiet]]

  -d,--debug          Indicates debugging mode
  -f,--infile &lt;path&gt;  Path to a Globus credential (defaults to stdin)
  -h,--help           Displays help message
  -o,--outfile &lt;path&gt; Send the output to this file (defaults to stdout)
  -q,--quiet          Indicates quiet mode</pre>

    <p>To use the Extraction Tool, specify the path to a Globus credential on the command line:</p>

<pre>  UNIX:
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-saml-extract \
      --infile $GRIDSHIB_HOME/testproxy.pem</strong></pre>

<pre>  Windows:
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-saml-extract
      --infile %GRIDSHIB_HOME%\testproxy.pem</strong></pre>

<pre>  &lt;Assertion
    xmlns="urn:oasis:names:tc:SAML:1.0:assertion"
    xmlns:saml="urn:oasis:names:tc:SAML:1.0:assertion"
    xmlns:samlp="urn:oasis:names:tc:SAML:1.0:protocol"
    xmlns:xsd="http://www.w3.org/2001/XMLSchema"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    AssertionID="_0da90d5af5898cbf979138bcef9110d9"
    IssueInstant="2008-01-07T15:48:25.306Z"
    Issuer="CN=gridshib.example.org,O=example.org,C=US"
    MajorVersion="1" MinorVersion="1"&gt;
    &lt;AttributeStatement&gt;
      &lt;Subject&gt;
        &lt;NameIdentifier
          Format="urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified"&gt;
          trscavo
        &lt;/NameIdentifier&gt;
        &lt;SubjectConfirmation&gt;
          &lt;ConfirmationMethod&gt;
            urn:oasis:names:tc:SAML:1.0:cm:sender-vouches
          &lt;/ConfirmationMethod&gt;
        &lt;/SubjectConfirmation&gt;
      &lt;/Subject&gt;
      &lt;Attribute
        AttributeName="urn:oid:1.3.6.1.4.1.5923.1.5.1.1"
        AttributeNamespace="urn:mace:shibboleth:1.0:attributeNamespace:uri"&gt;
        &lt;AttributeValue xsi:type="xsd:string"&gt;
          http://www.nanohub.org
        &lt;/AttributeValue&gt;
        &lt;AttributeValue xsi:type="xsd:string"&gt;
          http://www.gisolve.org
        &lt;/AttributeValue&gt;
      &lt;/Attribute&gt;
      &lt;Attribute
        AttributeName="urn:oid:2.5.4.6"
        AttributeNamespace="urn:mace:shibboleth:1.0:attributeNamespace:uri"&gt;
        &lt;AttributeValue xsi:type="xsd:string"&gt;
          US
        &lt;/AttributeValue&gt;
      &lt;/Attribute&gt;
    &lt;/AttributeStatement&gt;
  &lt;/Assertion&gt;</pre>

    <p>The previous commands direct the output to stdout.  To write the output to a file, use the <span class="command-line-option">--outfile</span> option:</p>

<pre>  UNIX:
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-saml-extract \
      --infile $GRIDSHIB_HOME/testproxy.pem \
      --outfile $GRIDSHIB_HOME/testassertion.xml</strong></pre>

<pre>  Windows:
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-saml-extract
      --infile %GRIDSHIB_HOME%\testproxy.pem
      --outfile %GRIDSHIB_HOME%\testassertion.xml</strong></pre>

    <p>Note that all of the command-line options for the Extraction Tool are optional.  Even the <span class="command-line-option">--infile</span> is optional, as illustrated below:</p>

<pre>  UNIX:
  $ <strong>cat $GRIDSHIB_HOME/testproxy.pem \
      | $GRIDSHIB_HOME/bin/gridshib-saml-extract</strong></pre>

<pre>  Windows:
  &gt; <strong>type %GRIDSHIB_HOME%\testproxy.pem
      | %GRIDSHIB_HOME%\bin\gridshib-saml-extract</strong></pre>

    <p>So if either of the <span class="command-line-option">--infile</span> or <span class="command-line-option">--outfile</span> options are omitted, stdin and stdout (resp.) are assumed.</p>

    <h2><a name="using_saml_info_tool">Using the SAML Security Info Tool</a></h2>

    <p>The <em>SAML Security Info Tool</em> takes a Globus credential as input, traverses the proxy certificate chain looking for SAML content, and displays the result on standard output (by default).  The Info Tool is invoked as follows:</p>

<pre>  UNIX:
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-saml-info --help</strong></pre>

<pre>  Windows:
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-saml-info --help</strong></pre>

<pre>  Description: Prints the SAML security information bound to the
  specified credential

  usage: gridshib-saml-info [--help | [--infile &lt;path&gt;] [--outfile &lt;path&gt;]
                            [--verbose | --extract] [--debug] [--quiet]]

  -d,--debug          Indicates debugging mode
  -e,--extract        Indicates a SAML assertion is to be extracted
                      (precludes the verbose option)
  -f,--infile &lt;path&gt;  Path to a Globus credential (defaults to stdin)
  -h,--help           Displays help message
  -o,--outfile &lt;path&gt; Send the output to this file (defaults to stdout)
  -q,--quiet          Indicates quiet mode
  -v,--verbose        Indicates verbose mode (precludes the extract option)</pre>

    <p>To use the Info Tool, specify the path to a Globus credential on the command line:</p>

<pre>  UNIX:
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-saml-info \
      --infile $GRIDSHIB_HOME/testproxy.pem</strong></pre>

<pre>  Windows:
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-saml-info
      --infile %GRIDSHIB_HOME%\testproxy.pem</strong></pre>

<pre>  (untrusted) SAMLIdentity {
    issuer='CN=gridshib.example.org,O=example.org,C=US'
    nameID='&lt;NameIdentifier
              xmlns="urn:oasis:names:tc:SAML:1.0:assertion"
              Format="urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified"&gt;
              trscavo
            &lt;/NameIdentifier&gt;'
  }
  (untrusted) BasicAttribute {
    issuer='CN=gridshib.example.org,O=example.org,C=US'
    name='urn:oid:2.5.4.6'
    nameFormat='urn:mace:shibboleth:1.0:attributeNamespace:uri'
    value #1='US'
  }
  (untrusted) BasicAttribute {
    issuer='CN=gridshib.example.org,O=example.org,C=US'
    name='urn:oid:1.3.6.1.4.1.5923.1.5.1.1'
    nameFormat='urn:mace:shibboleth:1.0:attributeNamespace:uri'
    value #1='http://www.gisolve.org'
    value #2='http://www.nanohub.org'
  }</pre>

    <p>Most of the Info Tool options are the same as the <a href="#using_saml_extraction_tool">Extraction Tool</a>.  The Info Tool adds two new options, the <span class="command-line-option">--verbose</span> option and the <span class="command-line-option">--extract</span> option. For verbose output, which includes the string representations of the X.509 certificates in the proxy certificate chain as well as the raw SAML assertions bound to those certificates, use the <span class="command-line-option">--verbose</span> option:</p>

<pre>  UNIX:
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-saml-info --verbose \
      --infile $GRIDSHIB_HOME/testproxy.pem</strong></pre>

<pre>  Windows:
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-saml-info --verbose
      --infile %GRIDSHIB_HOME%\testproxy.pem</strong></pre>

<pre>  X509Certificate {
    (verbose output omitted)
  }
  X509Certificate {
    (verbose output omitted)
  }
  SAMLAssertion {
    &lt;Assertion
      xmlns="urn:oasis:names:tc:SAML:1.0:assertion"
      xmlns:saml="urn:oasis:names:tc:SAML:1.0:assertion"
      xmlns:samlp="urn:oasis:names:tc:SAML:1.0:protocol"
      xmlns:xsd="http://www.w3.org/2001/XMLSchema"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      AssertionID="_0da90d5af5898cbf979138bcef9110d9"
      IssueInstant="2008-01-07T15:48:25.306Z"
      Issuer="CN=gridshib.example.org,O=example.org,C=US"
      MajorVersion="1" MinorVersion="1"&gt;
      &lt;AttributeStatement&gt;
        &lt;Subject&gt;
          &lt;NameIdentifier
            Format="urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified"&gt;
            trscavo
          &lt;/NameIdentifier&gt;
          &lt;SubjectConfirmation&gt;
            &lt;ConfirmationMethod&gt;
              urn:oasis:names:tc:SAML:1.0:cm:sender-vouches
            &lt;/ConfirmationMethod&gt;
          &lt;/SubjectConfirmation&gt;
        &lt;/Subject&gt;
        &lt;Attribute
          AttributeName="urn:oid:1.3.6.1.4.1.5923.1.5.1.1"
          AttributeNamespace="urn:mace:shibboleth:1.0:attributeNamespace:uri"&gt;
          &lt;AttributeValue xsi:type="xsd:string"&gt;
            http://www.nanohub.org
          &lt;/AttributeValue&gt;
          &lt;AttributeValue xsi:type="xsd:string"&gt;
            http://www.gisolve.org
          &lt;/AttributeValue&gt;
        &lt;/Attribute&gt;
        &lt;Attribute
          AttributeName="urn:oid:2.5.4.6"
          AttributeNamespace="urn:mace:shibboleth:1.0:attributeNamespace:uri"&gt;
          &lt;AttributeValue xsi:type="xsd:string"&gt;
            US
          &lt;/AttributeValue&gt;
        &lt;/Attribute&gt;
      &lt;/AttributeStatement&gt;
    &lt;/Assertion&gt;
  }
  (untrusted) SAMLIdentity {
    issuer='CN=gridshib.example.org,O=example.org,C=US'
    nameID='&lt;NameIdentifier
              xmlns="urn:oasis:names:tc:SAML:1.0:assertion"
              Format="urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified"&gt;
              trscavo
            &lt;/NameIdentifier&gt;'
  }
  (untrusted) BasicAttribute {
    issuer='CN=gridshib.example.org,O=example.org,C=US'
    name='urn:oid:2.5.4.6'
    nameFormat='urn:mace:shibboleth:1.0:attributeNamespace:uri'
    value #1='US'
  }
  (untrusted) BasicAttribute {
    issuer='CN=gridshib.example.org,O=example.org,C=US'
    name='urn:oid:1.3.6.1.4.1.5923.1.5.1.1'
    nameFormat='urn:mace:shibboleth:1.0:attributeNamespace:uri'
    value #1='http://www.gisolve.org'
    value #2='http://www.nanohub.org'
  }</pre>

    <p>If only a SAML assertion is desired in the output, use the <span class="command-line-option">--extract</span> option.  This option extracts the SAML assertion from the last certificate in the proxy certificate chain, as if you had used the <a href="#using_saml_extraction_tool">Extraction Tool</a> to do so.</p>

    <p>Like the <a href="#using_saml_extraction_tool">Extraction Tool</a>, all of the command-line options for the Info Tool are optional:</p>

<pre>  UNIX:
  $ <strong>cat $GRIDSHIB_HOME/testproxy.pem \
      | $GRIDSHIB_HOME/bin/gridshib-saml-info</strong></pre>

<pre>  Windows:
  &gt; <strong>type %GRIDSHIB_HOME%\testproxy.pem
      | %GRIDSHIB_HOME%\bin\gridshib-saml-info</strong></pre>

    <p>In other words, if either <span class="command-line-option">--infile</span> or <span class="command-line-option">--outfile</span> are omitted, stdin and stdout (resp.) are assumed.</p>

    <h2><a name="using_x509_binding_tool">Using the X.509 Binding Tool</a></h2>

    <p>The <em>X.509 Binding Tool</em> is a general tool for binding arbitrary content to a non-critical extension of an X.509 proxy certificate.  You invoke the Binding Tool as follows:</p>

<pre>  UNIX:
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-proxy-bind --help</strong></pre>

<pre>  Windows:
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-proxy-bind --help</strong></pre>

<pre>  Description: Binds arbitrary content to a non-critical extension of an
  X.509 proxy certificate

  usage: gridshib-proxy-bind --help
  usage: gridshib-proxy-bind --oid &lt;oid&gt; [--saml | --asn1]
                             [--x509 [--x509Lifetime &lt;secs&gt;]]
                             [--config &lt;path&gt;]
                             [--properties  &lt;name=value&gt; ...]
                             [--certPath &lt;path&gt; --keyPath &lt;path&gt;]
                             [--infile &lt;path&gt;] [--outfile &lt;path&gt;]
                             [--debug] [--quiet]

  -A,--asn1                    Indicates the input is a DER-encoded ASN.1
                               structure (the default input option)
  -c,--certPath                Path to certificate of the issuing credential
  -d,--debug                   Indicates debugging mode
  -D,--properties &lt;name=value&gt; Arbitrary configuration properties
  -E,--x509Lifetime &lt;secs&gt;     Lifetime (in seconds) of the issued proxy
                               certificate (requires --x509 option)
  -F,--config &lt;path&gt;           A configuration file
  -f,--infile &lt;path&gt;           Path to arbitrary extension content to be
                               bound to the proxy certificate (if omitted,
                               defaults to stdin)
  -h,--help                    Displays help message
  -k,--keyPath                 Path to private key of the issuing credential
  -o,--outfile &lt;path&gt;          Send the output to this file
  -O,--oid &lt;oid&gt;               OID of non-critical certificate extension
  -q,--quiet                   Indicates quiet mode
  -S,--saml                    Indicates the input is a SAML assertion
  -X,--x509                    Indicates the output is a PEM-encoded
                               X.509 proxy credential</pre>

    <p>To use the Binding Tool, specify the OID of the certificate extension and the path to the extension content on the command line:</p>

<pre>  UNIX:
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-proxy-bind \
      --oid 1.3.6.1.4.1.3536.1.1.1.12 \
      --infile $GRIDSHIB_HOME/testextension.der</strong></pre>

<pre>  Windows:
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-proxy-bind
      --oid 1.3.6.1.4.1.3536.1.1.1.12
      --infile %GRIDSHIB_HOME%\testextension.der</strong></pre>

    <p>By default, the Binding Tool expects its input to be a DER-encoded ASN.1 structure and its output to be a proxy credential.  To make these defaults explicit, add the <span class="command-line-option">--asn1</span> and <span class="command-line-option">--x509</span> options (resp.):</p>

<pre>  UNIX:
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-proxy-bind \
      --oid 1.3.6.1.4.1.3536.1.1.1.12 \
      --asn1 --infile $GRIDSHIB_HOME/testextension.der \
      --x509</strong></pre>

<pre>  Windows:
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-proxy-bind
      --oid 1.3.6.1.4.1.3536.1.1.1.12
      --asn1 --infile %GRIDSHIB_HOME%\testextension.der
      --x509</strong></pre>

    <p>The <span class="command-line-option">--x509</span> option is the Binding Tool's only output option so we will omit it in the sample commands that follow.  There is one other input option, however.  The <span class="command-line-option">--saml</span> option declares the input to be a SAML assertion (XML):</p>

<pre>  UNIX:
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-proxy-bind \
      --oid 1.3.6.1.4.1.3536.1.1.1.12 \
      --saml --infile $GRIDSHIB_HOME/testassertion.xml</strong></pre>

<pre>  Windows:
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-proxy-bind
      --oid 1.3.6.1.4.1.3536.1.1.1.12
      --saml --infile %GRIDSHIB_HOME%\testassertion.xml</strong></pre>

    <p>The previous commands direct the output to stdout.  If you would rather write the output to a file, use the <span class="command-line-option">--outfile</span> option:</p>

<pre>  UNIX:
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-proxy-bind \
      --oid 1.3.6.1.4.1.3536.1.1.1.12 \
      --saml --infile $GRIDSHIB_HOME/testassertion.xml \
      --outfile $GRIDSHIB_HOME/testproxy.pem</strong></pre>

<pre>  Windows:
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-proxy-bind
      --oid 1.3.6.1.4.1.3536.1.1.1.12
      --saml --infile %GRIDSHIB_HOME%\testassertion.xml
      --outfile %GRIDSHIB_HOME%\testproxy.pem</strong></pre>

    <p>The above command will overwrite the proxy credential issued by the test script.  You can use the Info Tool to view the contents of the proxy certificate:</p>

<pre>  UNIX:
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-saml-info --infile $GRIDSHIB_HOME/testproxy.pem</strong></pre>

<pre>  Windows:
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-saml-info --infile %GRIDSHIB_HOME%\testproxy.pem</strong></pre>

    <p>Of all the options available to the Binding Tool, only <span class="command-line-option">--oid</span> is strictly required.  If either <span class="command-line-option">--infile</span> or <span class="command-line-option">--outfile</span> are omitted, stdin and stdout (resp.) are assumed:</p>

<pre>  UNIX:
  $ <strong>cat $GRIDSHIB_HOME/testassertion.xml \
      | $GRIDSHIB_HOME/bin/gridshib-proxy-bind --oid 1.3.6.1.4.1.3536.1.1.1.12 --saml \
      | $GRIDSHIB_HOME/bin/gridshib-saml-info --extract \
            --outfile /tmp/testassertion.xml</strong>
  $ <strong>diff $GRIDSHIB_HOME/testassertion.xml /tmp/testassertion.xml</strong></pre>

<pre>  Windows:
  &gt; <strong>type %GRIDSHIB_HOME%\testassertion.xml
      | %GRIDSHIB_HOME%\bin\gridshib-proxy-bind --oid 1.3.6.1.4.1.3536.1.1.1.12 --saml
      | %GRIDSHIB_HOME%\bin\gridshib-saml-info --extract
          --outfile %TEMP%\testassertion.xml</strong>
  &gt; <strong>comp %GRIDSHIB_HOME%\testassertion.xml %TEMP%\testassertion.xml</strong></pre>

    <p>Even though the above examples suggest otherwise, the Binding Tool will bind <em>any</em> content to a proxy certificate (not just a SAML assertion).  The Binding Tool does not process the input in any way, except in the case of the <span class="command-line-option">--saml</span> option where the input SAML assertion is encoded as an appropriate DER-encoded ASN.1 structure.</p>

    <h3><a name="configuring_binding_tool">Configuring the Binding Tool</a></h3>

    <p>The default configuration properties file for the Binding Tool is located at</p>

<pre>  $GRIDSHIB_HOME/etc/gridshib-saml-tools-config.properties</pre>

    <p>You can modify the default properties file to suit your needs, or you can create a new properties file altogether (recommended):</p>

<pre>  UNIX:
  $ <strong>cp $GRIDSHIB_HOME/etc/gridshib-saml-tools-config.properties /tmp</strong>
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-proxy-bind \
      --oid 1.3.6.1.4.1.3536.1.1.1.12 \
      --asn1 --infile $GRIDSHIB_HOME/testextension.der \
      --outfile $GRIDSHIB_HOME/testproxy2.pem \
      --config /tmp/gridshib-saml-tools-config.properties</strong>
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-saml-info --infile $GRIDSHIB_HOME/testproxy2.pem</strong></pre>

<pre>  Windows:
  &gt; <strong>copy %GRIDSHIB_HOME%\etc\gridshib-saml-tools-config.properties %TEMP%</strong>
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-proxy-bind
      --oid 1.3.6.1.4.1.3536.1.1.1.12
      --asn1 --infile %GRIDSHIB_HOME%\testextension.der
      --outfile %GRIDSHIB_HOME%\testproxy2.pem
      --config %TEMP%\gridshib-saml-tools-config.properties</strong>
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-saml-info --infile %GRIDSHIB_HOME%\testproxy2.pem</strong></pre>

    <p>See the <a href="#configuring_saml_tools">configuration section</a> for more information about configuration files.</p>

    <h2><a name="using_saml_issuer_tool">Using the SAML Assertion Issuer Tool</a></h2>

    <p>The <em>SAML Assertion Issuer Tool</em> self-issues a SAML assertion and optionally binds this assertion to an X.509 proxy certificate.  One invokes the Issuer Tool as follows:</p>

<pre>  UNIX:
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-saml-issuer --help</strong></pre>

<pre>  Windows:
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-saml-issuer --help</strong></pre>

<pre>  Description: Self-issues a SAML assertion and optionally binds this
  assertion to an X.509 proxy certificate

  usage: gridshib-saml-issuer --help
  usage: gridshib-saml-issuer [[--user &lt;name&gt;] --holder-of-key]
                              [--lifetime &lt;secs&gt;]
                              [--saml | --asn1 | --x509 [--x509Lifetime &lt;secs&gt;]]
                              [--config &lt;path&gt;] [--properties &lt;name=value&gt; ...]
                              [--certPath &lt;path&gt; --keyPath &lt;path&gt;]
                              [--infile &lt;path&gt;] [--outfile &lt;path&gt;]
                              [--debug] [--quiet]
  usage: gridshib-saml-issuer --user &lt;name&gt; --sender-vouches
                              [--lifetime &lt;secs&gt;]
                              [--ssoResponse &lt;path&gt; |
                                --authn --authnInstant &lt;dateTime&gt;
                                [--authnMethod &lt;URI&gt;] [--address &lt;IPAddress&gt;]]
                              [--saml | --asn1 | --x509 [--x509Lifetime &lt;secs&gt;]]
                              [--config &lt;path&gt;] [--properties &lt;name=value&gt; ...]
                              [--certPath &lt;path&gt; --keyPath &lt;path&gt;]
                              [--infile &lt;path&gt;] [--outfile &lt;path&gt;]
                              [--debug] [--quiet]

  -a,--authn                   Indicates a &lt;saml:AuthenticationStatement&gt;
                               element is to  be issued (requires the
                               --sender-vouches option and is mutually exclusive
                               with the --ssoResponse option)
  -A,--asn1                    Indicates the output is to be a DER-encoded
                               ASN.1 structure
  -c,--certPath                Path to certificate of the issuing credential
  -d,--debug                   Indicates debugging mode
  -D,--properties &lt;name=value&gt; Arbitrary configuration properties
  -e,--lifetime &lt;secs&gt;         Lifetime (in seconds) of the SAML assertion
  -E,--x509Lifetime &lt;secs&gt;     Lifetime (in seconds) of the issued proxy
                               certificate (requires --x509 option)
  -F,--config &lt;path&gt;           The path to a configuration file
  -f,--infile &lt;path&gt;           The path to arbitrary XML content to be
                               bound to the SAML assertion's &lt;Advice&gt; element
  -h,--help                    Displays help message
  -i,--address &lt;IPAddress&gt;     Subject IP address (requires --authn option)
  -I,--authnInstant &lt;dateTime&gt; SAML AuthenticationInstant (requires and is
                               required by the --authn option)
  -k,--keyPath                 Path to private key of the issuing credential
  -K,--holder-of-key           Indicates holder-of-key subject confirmation
                               (the default subject confirmation option)
  -M,--authnMethod &lt;URI&gt;       SAML AuthenticationMethod URI (requires the
                               --authn option)
  -o,--outfile &lt;path&gt;          Send the output to this file
  -q,--quiet                   Indicates quiet mode
  -R,--ssoResponse &lt;path&gt;      The path to a SAML Web Browser SSO Response
                               (requires the --sender-vouches option and is
                               mutually exclusive with the --authn option)
  -S,--saml                    Indicates the output is a SAML assertion
                               (the default output option)
  -u,--user &lt;name&gt;             Local principal name (i.e., username)
  -V,--sender-vouches          Indicates sender-vouches subject confirmation
                               (requires --user option)
  -X,--x509                    Indicates the output is a PEM-encoded X.509
                               proxy credential</pre>

    <p>The Issuer Tool produces two distinct kinds of assertions, with <code>holder-of-key</code> or <code>sender-vouches</code> subject confirmation.  Both types of assertions are <em>self-issued</em>, that is, the assertion issuer and the X.509 issuer are one and the same entity.  The distinction between the two lies with the presenter of the certificate.  If the presenter is the SAML subject, a <code>holder-of-key</code> assertion is required.  If, on the other hand, the presenter is acting on behalf of the subject, a <code>sender-vouches</code> assertion is issued.  A portal or gateway falls into the latter category, for instance.</p>

    <h3><a name="issuing_holder-of-key">Issuing <code>holder-of-key</code> SAML assertions</a></h3>

    <blockquote><div style="font-style: italic"><strong>Use Case:</strong> The presenter of the X.509-bound SAML token is the subject.</div></blockquote>

    <p>The following sample invocations of the <code>gridshib-saml-issuer</code> command-line script show how to use the Issuer Tool to self-issue <code>holder-of-key</code> SAML assertions.  The simplest example invokes the script with no options:</p>

<pre>  UNIX:
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-saml-issuer</strong></pre>

<pre>  Windows:
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-saml-issuer</strong></pre>

<pre>  &lt;Assertion
    xmlns="urn:oasis:names:tc:SAML:1.0:assertion"
    xmlns:saml="urn:oasis:names:tc:SAML:1.0:assertion"
    xmlns:samlp="urn:oasis:names:tc:SAML:1.0:protocol"
    xmlns:xsd="http://www.w3.org/2001/XMLSchema"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    AssertionID="_68d3fb4a4928c628feef243ad551d07b"
    IssueInstant="2008-06-22T23:26:53.343Z"
    Issuer="CN=gridshib.example.org,O=example.org,C=US"
    MajorVersion="1" MinorVersion="1"&gt;
    &lt;AttributeStatement&gt;
      &lt;Subject&gt;
        &lt;NameIdentifier
          Format="urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName"&gt;
          CN=gridshib.example.org,O=example.org,C=US
        &lt;/NameIdentifier&gt;
      &lt;/Subject&gt;
      &lt;Attribute
        AttributeName="urn:oid:2.5.4.6"
        AttributeNamespace="urn:mace:shibboleth:1.0:attributeNamespace:uri"&gt;
        &lt;AttributeValue xsi:type="xsd:string"&gt;
          US
        &lt;/AttributeValue&gt;
      &lt;/Attribute&gt;
      &lt;Attribute
        AttributeName="urn:oid:1.3.6.1.4.1.5923.1.5.1.1"
        AttributeNamespace="urn:mace:shibboleth:1.0:attributeNamespace:uri"&gt;
        &lt;AttributeValue xsi:type="xsd:string"&gt;
          group://nanohub.org/nanohub
        &lt;/AttributeValue&gt;
        &lt;AttributeValue xsi:type="xsd:string"&gt;
          group://gisolve.org/gisolve
        &lt;/AttributeValue&gt;
      &lt;/Attribute&gt;
    &lt;/AttributeStatement&gt;
  &lt;/Assertion&gt;</pre>

    <p>This outputs a <code>holder-of-key</code> SAML assertion to stdout.  To make the subject confirmation method explicit, add the <span class="command-line-option">--holder-of-key</span> option:</p>

<pre>  UNIX:
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-saml-issuer --holder-of-key</strong></pre>

<pre>  Windows:
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-saml-issuer --holder-of-key</strong></pre>

    <p>Note that the assertion produced by the above commands has a distinguished name (DN) as the value of its <code>NameIdentifier</code> element.  This is the subject DN of the user's end entity certificate.  For other types of name identifiers, specify the <span class="command-line-option">--user</span> option:</p>

<pre>  UNIX:
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-saml-issuer --user trscavo --holder-of-key</strong></pre>

<pre>  Windows:
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-saml-issuer --user trscavo --holder-of-key</strong></pre>

    <p>When the <span class="command-line-option">--user</span> option is specified in this way, the <code>NameIdentifier</code> element is formatted according to a <a href="#configuring_saml_nameid">configuration file</a>.</p>

    <p>Note also that a <code>holder-of-key</code> assertion doesn't actually have a SAML <code>&lt;SubjectConfirmation&gt;</code> element.  Since the assertion is ultimately bound to an X.509 certificate, <code>holder-of-key</code> is implied and therefore omitted in this case.  In other cases, it is desirable to produce a SAML assertion with explicit <code>sender-vouches</code> subject confirmation.</p>

    <h3><a name="issuing_sender-vouches">Issuing <code>sender-vouches</code> SAML assertions</a></h3>

    <blockquote><div style="font-style: italic"><strong>Use Case:</strong> The presenter of the X.509-bound SAML token is acting on behalf of the subject.</div></blockquote>

    <p>This section shows how to use the Issuer Tool to self-issue <code>sender-vouches</code> SAML assertions.  The following command produces a SAML assertion with explicit <code>sender-vouches</code> subject confirmation:</p>

<pre>  UNIX:
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-saml-issuer --user trscavo --sender-vouches</strong></pre>

<pre>  Windows:
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-saml-issuer --user trscavo --sender-vouches</strong></pre>

<pre>  &lt;Assertion
    xmlns="urn:oasis:names:tc:SAML:1.0:assertion"
    xmlns:saml="urn:oasis:names:tc:SAML:1.0:assertion"
    xmlns:samlp="urn:oasis:names:tc:SAML:1.0:protocol"
    xmlns:xsd="http://www.w3.org/2001/XMLSchema"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    AssertionID="_783202c485b49c3c9054f8e427b538ef"
    IssueInstant="2008-06-22T23:36:54.508Z"
    Issuer="CN=gridshib.example.org,O=example.org,C=US"
    MajorVersion="1" MinorVersion="1"&gt;
    &lt;AttributeStatement&gt;
      &lt;Subject&gt;
        &lt;NameIdentifier
          Format="urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified"&gt;
          trscavo
        &lt;/NameIdentifier&gt;
        &lt;SubjectConfirmation&gt;
          &lt;ConfirmationMethod&gt;
            urn:oasis:names:tc:SAML:1.0:cm:sender-vouches
          &lt;/ConfirmationMethod&gt;
        &lt;/SubjectConfirmation&gt;
      &lt;/Subject&gt;
      &lt;Attribute
        AttributeName="urn:oid:2.5.4.6"
        AttributeNamespace="urn:mace:shibboleth:1.0:attributeNamespace:uri"&gt;
        &lt;AttributeValue xsi:type="xsd:string"&gt;
          US
        &lt;/AttributeValue&gt;
      &lt;/Attribute&gt;
      &lt;Attribute
        AttributeName="urn:oid:1.3.6.1.4.1.5923.1.5.1.1"
        AttributeNamespace="urn:mace:shibboleth:1.0:attributeNamespace:uri"&gt;
        &lt;AttributeValue xsi:type="xsd:string"&gt;
          group://nanohub.org/nanohub
        &lt;/AttributeValue&gt;
        &lt;AttributeValue xsi:type="xsd:string"&gt;
          group://gisolve.org/gisolve
        &lt;/AttributeValue&gt;
      &lt;/Attribute&gt;
    &lt;/AttributeStatement&gt;
  &lt;/Assertion&gt;</pre>

    <p>In this case, the assertion does indeed contain a <code>&lt;SubjectConfirmation&gt;</code> element (otherwise <code>holder-of-key</code> would be implied) with its <code>&lt;ConfirmationMethod&gt;</code> element set to the standard <code>sender-vouches</code> URI.  Also note that the <span class="command-line-option">--user</span> option is required in this case since the presenter of a <code>sender-vouches</code> assertion is not the subject, and therefore a name identifier can not be inferred.</p>

    <p>In the examples thus far, the Issuer Tool outputs a SAML assertion.  To make this explicit, add the <span class="command-line-option">--saml</span> option:</p>

<pre>  UNIX:
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-saml-issuer --user trscavo --sender-vouches \
      --saml</strong></pre>

<pre>  Windows:
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-saml-issuer --user trscavo --sender-vouches
      --saml</strong></pre>

    <p>The output of the above command (a SAML assertion) will be written to stdout.  To direct the output to a file, type:</p>

<pre>  UNIX:
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-saml-issuer --user trscavo --sender-vouches \
      --saml --outfile $GRIDSHIB_HOME/testassertion.xml</strong></pre>

<pre>  Windows:
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-saml-issuer --user trscavo --sender-vouches
      --saml --outfile %GRIDSHIB_HOME%\testassertion.xml</strong></pre>

    <p>The above command will overwrite the SAML assertion issued by the test script.  If you inspect the output SAML assertion with a text editor, you'll notice that the assertion contains a SAML <code>AttributeStatement</code> element.  The names and values of the attributes in the <code>AttributeStatement</code> are defined in a Java properties file:</p>

<pre>  UNIX:
  $ <strong>more $GRIDSHIB_HOME/etc/gridshib-saml-tools-config.properties</strong></pre>

<pre>  Windows:
  &gt; <strong>more < %GRIDSHIB_HOME%\etc\gridshib-saml-tools-config.properties</strong></pre>

    <p>To alter the configuration of the Issuer Tool, <a href="#configuring_issuer_tool">modify the default properties file or create a new one</a>.<p>

    <p>To bind the SAML assertion to an X.509 proxy certificate, use the <span class="command-line-option">--x509</span> command-line option in lieu of the <span class="command-line-option">--saml</span> option:</p>

<pre>  UNIX:
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-saml-issuer --user trscavo --sender-vouches \
      --x509 --outfile $GRIDSHIB_HOME/testproxy.pem</strong></pre>

<pre>  Windows:
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-saml-issuer --user trscavo --sender-vouches
      --x509 --outfile %GRIDSHIB_HOME%\testproxy.pem</strong></pre>

    <p>Again, you can use the Info Tool to view the SAML contents of the proxy certificate:</p>

<pre>  UNIX:
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-saml-info --infile $GRIDSHIB_HOME/testproxy.pem</strong></pre>

<pre>  Windows:
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-saml-info --infile %GRIDSHIB_HOME%\testproxy.pem</strong></pre>

    <p><a name="authn-examples">An <code>AuthenticationStatement</code> is easily added to a <code>sender-vouches</code> SAML assertion:</a></p>

<pre>  UNIX:
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-saml-issuer --user trscavo --sender-vouches \
      --saml --outfile $GRIDSHIB_HOME/testassertion.xml \
      --authn --authnInstant 2007-08-02T12:10:34-0400</strong></pre>

<pre>  Windows:
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-saml-issuer --user trscavo --sender-vouches
      --saml --outfile %GRIDSHIB_HOME%\testassertion.xml
      --authn --authnInstant 2007-08-02T12:10:34-0400</strong></pre>

    <p>Note that the <span class="command-line-option">--authn</span> option requires the <span class="command-line-option">--authnInstant</span> option (and vice versa).  Other options that modify the content of the <code>AuthenticationStatement</code> include the <span class="command-line-option">--authnMethod</span> and <span class="command-line-option">--address</span> options.  For example, try:</p>

<pre>  UNIX:
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-saml-issuer --user trscavo --sender-vouches \
      --saml --outfile $GRIDSHIB_HOME/testassertion.xml \
      --authn --authnInstant 2007-08-02T12:10:34-0400 \
      --authnMethod urn:oasis:names:tc:SAML:1.0:am:password \
      --address 255.255.255.255</strong>
  $ <strong>cat $GRIDSHIB_HOME/testassertion.xml</strong></pre>

<pre>  Windows:
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-saml-issuer --user trscavo --sender-vouches
      --saml --outfile %GRIDSHIB_HOME%\testassertion.xml
      --authn --authnInstant 2007-08-02T12:10:34-0400
      --authnMethod urn:oasis:names:tc:SAML:1.0:am:password
      --address 255.255.255.255</strong>
  &gt; <strong>type %GRIDSHIB_HOME%\testassertion.xml</strong></pre>

<pre>  &lt;Assertion
    xmlns="urn:oasis:names:tc:SAML:1.0:assertion"
    xmlns:saml="urn:oasis:names:tc:SAML:1.0:assertion"
    xmlns:samlp="urn:oasis:names:tc:SAML:1.0:protocol"
    xmlns:xsd="http://www.w3.org/2001/XMLSchema"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    AssertionID="_d7b1e5e50fb055928cad40a17eeadc76"
    IssueInstant="2008-06-22T23:48:52.110Z"
    Issuer="CN=gridshib.example.org,O=example.org,C=US"
    MajorVersion="1" MinorVersion="1"&gt;
    &lt;AuthenticationStatement
      AuthenticationInstant="2007-08-02T16:10:34.000Z"
      AuthenticationMethod="urn:oasis:names:tc:SAML:1.0:am:password"&gt;
      &lt;Subject&gt;
        &lt;NameIdentifier
          Format="urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified"&gt;
          trscavo
        &lt;/NameIdentifier&gt;
        &lt;SubjectConfirmation&gt;
          &lt;ConfirmationMethod&gt;
            urn:oasis:names:tc:SAML:1.0:cm:sender-vouches
          &lt;/ConfirmationMethod&gt;
        &lt;/SubjectConfirmation&gt;
      &lt;/Subject&gt;
      &lt;SubjectLocality IPAddress="255.255.255.255"&gt;&lt;/SubjectLocality&gt;
    &lt;/AuthenticationStatement&gt;
    &lt;AttributeStatement&gt;
      &lt;Subject&gt;
        &lt;NameIdentifier
          Format="urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified"&gt;
          trscavo
        &lt;/NameIdentifier&gt;
        &lt;SubjectConfirmation&gt;
          &lt;ConfirmationMethod&gt;
            urn:oasis:names:tc:SAML:1.0:cm:sender-vouches
          &lt;/ConfirmationMethod&gt;
        &lt;/SubjectConfirmation&gt;
      &lt;/Subject&gt;
      &lt;Attribute
        AttributeName="urn:oid:1.3.6.1.4.1.5923.1.5.1.1"
        AttributeNamespace="urn:mace:shibboleth:1.0:attributeNamespace:uri"&gt;
        &lt;AttributeValue xsi:type="xsd:string"&gt;
          group://nanohub.org/nanohub
        &lt;/AttributeValue&gt;
        &lt;AttributeValue xsi:type="xsd:string"&gt;
          group://gisolve.org/gisolve
        &lt;/AttributeValue&gt;
      &lt;/Attribute&gt;
      &lt;Attribute
        AttributeName="urn:oid:2.5.4.6"
        AttributeNamespace="urn:mace:shibboleth:1.0:attributeNamespace:uri"&gt;
        &lt;AttributeValue xsi:type="xsd:string"&gt;
          US
        &lt;/AttributeValue&gt;
      &lt;/Attribute&gt;
    &lt;/AttributeStatement&gt;
  &lt;/Assertion&gt;</pre>

    <p>In lieu of an <code>AuthenticationStatement</code>, you can include the assertion content of an SSO <code>Response</code> issued by a SAML identity provider (such as a Shibboleth IdP):</p>

<pre>  UNIX:
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-saml-issuer --user trscavo --sender-vouches \
      --x509 --outfile $GRIDSHIB_HOME/testproxynestsaml.pem \
      --ssoResponse /tmp/sso-response.xml</strong></pre>

<pre>  Windows:
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-saml-issuer --user trscavo --sender-vouches
      --x509 --outfile %GRIDSHIB_HOME%\testproxynestsaml.pem
      --ssoResponse %TEMP%\sso-response.xml</strong></pre>

    <p>The above command extracts a SAML assertion containing an <code>AuthenticationStatement</code> from the <code>Response</code>, and then nests that assertion in the <code>Advice</code> element of the X.509-bound SAML assertion.</p>

    <p>Finally, to bind the SAML assertion to a DER-encoded ASN.1 structure, use the <span class="command-line-option">--asn1</span> command-line option in lieu of the <span class="command-line-option">--x509</span> option or the <span class="command-line-option">--saml</span> option:</p>

<pre>  UNIX:
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-saml-issuer --user trscavo --sender-vouches \
      --asn1 --outfile $GRIDSHIB_HOME/testextension.der</strong></pre>

<pre>  Windows:
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-saml-issuer --user trscavo --sender-vouches
      --asn1 --outfile %GRIDSHIB_HOME%\testextension.der</strong></pre>

    <p>The DER-encoded certificate extension can be used as input to openssl or the Binding Tool.  For example:</p>

<pre>  UNIX:
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-saml-issuer --user trscavo --sender-vouches --asn1 \
      | $GRIDSHIB_HOME/bin/gridshib-proxy-bind --oid 1.3.6.1.4.1.3536.1.1.1.12 --asn1 \
      | $GRIDSHIB_HOME/bin/gridshib-saml-info</strong></pre>

<pre>  Windows:
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-saml-issuer --user trscavo --sender-vouches --asn1
      | %GRIDSHIB_HOME%\bin\gridshib-proxy-bind --oid 1.3.6.1.4.1.3536.1.1.1.12 --asn1
      | %GRIDSHIB_HOME%\bin\gridshib-saml-info</strong></pre>

    <p>A SAML assertion may be bound similarly:</p>

<pre>  UNIX:
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-saml-issuer --user trscavo --sender-vouches --saml \
      | $GRIDSHIB_HOME/bin/gridshib-proxy-bind --oid 1.3.6.1.4.1.3536.1.1.1.12 --saml \
      | $GRIDSHIB_HOME/bin/gridshib-saml-info</strong></pre>

<pre>  Windows:
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-saml-issuer --user trscavo --sender-vouches --saml
      | %GRIDSHIB_HOME%\bin\gridshib-proxy-bind --oid 1.3.6.1.4.1.3536.1.1.1.12 --saml
      | %GRIDSHIB_HOME%\bin\gridshib-saml-info</strong></pre>

    <p>Other types of content may be bound to a proxy certificate using the Binding Tool.</p>

    <h3><a name="configuring_issuer_tool">Configuring the Issuer Tool</a></h3>

    <p>The default configuration properties file for the Issuer Tool is located at</p>

<pre>  $GRIDSHIB_HOME/etc/gridshib-saml-tools-config.properties</pre>

    <p>You can modify the default properties file to suit your needs, or you can create a new properties file altogether (recommended):</p>

<pre>  UNIX:
  $ <strong>cp $GRIDSHIB_HOME/etc/gridshib-saml-tools-config.properties /tmp</strong>
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-saml-issuer --user trscavo --sender-vouches \
      --outfile $GRIDSHIB_HOME/testassertion.xml \
      --config /tmp/gridshib-saml-tools-config.properties</strong>
  $ <strong>cat $GRIDSHIB_HOME/testassertion.xml</strong></pre>

<pre>  Windows:
  &gt; <strong>copy %GRIDSHIB_HOME%\etc\gridshib-saml-tools-config.properties %TEMP%</strong>
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-saml-issuer --user trscavo --sender-vouches
      --outfile %GRIDSHIB_HOME%\testassertion.xml
      --config %TEMP%\gridshib-saml-tools-config.properties</strong>
  &gt; <strong>type %GRIDSHIB_HOME%\testassertion.xml</strong></pre>

    <p>See the <a href="#configuring_saml_tools">configuration section</a> for more information about configuration files.</p>

    <h2><a name="using_saml_verify_tool">Using the SAML Assertion Verify Tool</a></h2>

    <p>The <em>SAML Assertion Verify Tool</em> invokes the <a href="#using_saml_issuer_tool">SAML Assertion Issuer Tool</a> to obtain a SAML assertion.  It then verifies that the assertion agrees with the command-line arguments and configuration parameters available to the Issuer Tool.  Thus the Verify Tool has exactly the same command-line interface as the Issuer Tool.</p>

    <p>The Verify Tool emits exit code&nbsp;0 if and only if the verification succeeds:</p>

<pre>  UNIX:
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-saml-verify --user trscavo --sender-vouches</strong>
  $ <strong>echo $?</strong>
  0</pre>

<pre>  Windows:
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-saml-verify --user trscavo --sender-vouches</strong>
  &gt; <strong>echo %errorlevel%</strong>
  0</pre>

    <p>The Verify Tool has no output.</p>

    <h2><a name="configuring_saml_tools">Configuring the SAML Tools</a></h2>

    <p>The various configuration parameters used by the SAML Tools are summarized in the following table:</p>

    <table>
      <tr>
        <th style="text-align: left">Parameter</th>
        <th>Binding<br>Tool</th>
        <th>Issuer<br>Tool</th>
        <th>Since</th>
      </tr>
      <tr>
        <td class="config-parameter">IdP.entityID</td>
        <td class="unsupported-option"></td>
        <td class="optional-option"></td>
        <td class="version-number">0.2</td>
      </tr>
      <tr>
        <td class="config-parameter">NameID.Format</td>
        <td class="unsupported-option"></td>
        <td class="optional-option"></td>
        <td class="version-number">0.2</td>
      </tr>
      <tr>
        <td class="config-parameter">NameID.Format.template</td>
        <td class="unsupported-option"></td>
        <td class="optional-option"></td>
        <td class="version-number">0.2</td>
      </tr>
      <tr>
        <td class="config-parameter">NameID.NameQualifier</td>
        <td class="unsupported-option"></td>
        <td class="optional-option"></td>
        <td class="version-number">0.2</td>
      </tr>
      <tr>
        <td class="config-parameter">dateTime.pattern</td>
        <td class="unsupported-option"></td>
        <td class="optional-option"></td>
        <td class="version-number">0.2</td>
      </tr>
      <tr>
        <td class="config-parameter">Attribute.<i>label</i>.Namespace</td>
        <td class="unsupported-option"></td>
        <td class="optional-option"></td>
        <td class="version-number">0.1</td>
      </tr>
      <tr>
        <td class="config-parameter">Attribute.<i>label</i>.Name</td>
        <td class="unsupported-option"></td>
        <td class="optional-option"></td>
        <td class="version-number">0.1</td>
      </tr>
      <tr>
        <td class="config-parameter">Attribute.<i>label</i>.Value</td>
        <td class="unsupported-option"></td>
        <td class="optional-option"></td>
        <td class="version-number">0.1</td>
      </tr>
      <tr>
        <td class="config-parameter">certLocation</td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="version-number">0.1</td>
      </tr>
      <tr>
        <td class="config-parameter">keyLocation</td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="version-number">0.1</td>
      </tr>
      <tr>
        <td class="config-parameter">certPath</td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="version-number">0.1</td>
      </tr>
      <tr>
        <td class="config-parameter">keyPath</td>
        <td class="optional-option"></td>
        <td class="optional-option"></td>
        <td class="version-number">0.1</td>
      </tr>
      <tr style="border-top: solid black">
        <td colspan="5" style="border-top: solid black; text-align: center">
          Required: <span style="background-color: red">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> Optional: <span style="background-color: gray">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
        </td>
      </tr>
    </table>

    <p>See package org.globus.gridshib.config, especially class <code>SAMLToolsConfigLoader</code> for implementation details.</p>

    <h3><a name="configuring_x509_credential">Configuring the X.509 issuing credential</a></h3>

    <p>As mentioned in the <a href="#getting_started">Getting Started</a> section, the SAML Tools are pre-configured to use a test issuing credential out of the box.  For more advanced testing, and certainly for production deployments, you should configure the Tools to use a trusted X.509 credential instead.  This section shows how this is done.</p>

    <p>The system-independent file locations of the PEM-encoded certificate and private key of the issuing credential are specified in the config file as follows:</p>

<pre>  <strong>certLocation=file:///usr/local/security/mycert.pem
  keyLocation=file:///usr/local/security/mykey.pem</strong></pre>

    <p>In the above example, the certificate and key are contained in separate files, which is typical for a long-lived credential.  In the case of a short-lived credential, such as a proxy credential or a GridShib CA-issued end entity credential, the PEM-encoded certificate and private key are contained in the same file, as in this example:</p>

<pre>  <strong>certLocation=file:///tmp/x509up_u201
  keyLocation=file:///tmp/x509up_u201</strong></pre>

    <p>The default location of a short-lived credential on Windows is something like the following:</p>

<pre style="font-size: smaller">  <strong>certLocation=file:/C:/Documents%20and%20Settings/globus/Local%20Settings/Temp/x509up_u_globus
  keyLocation=file:/C:/Documents%20and%20Settings/globus/Local%20Settings/Temp/x509up_u_globus</strong></pre>

    <p>Note: The <span class="config-parameter">certLocation</span> and <span class="config-parameter">keyLocation</span> properties go together, that is, both <strong>must</strong> be specified (or omitted).  If one appears in the config file without the other, an exception is thrown when the properties file is loaded.</p>

    <p>Alternatively, the issuing credential may be specified using system-dependent <span class="config-parameter">certPath</span> and <span class="config-parameter">keyPath</span> properties. For example:</p>

<pre>  <strong>certPath=/tmp/x509up_u201
  keyPath=/tmp/x509up_u201</strong></pre>

     <p>or in the case of Windows</p>

<pre style="font-size: smaller">  <strong>certPath=C:\\Documents and Settings\\globus\\Local Settings\\Temp\\x509up_u_globus
  keyPath=C:\\Documents and Settings\\globus\\Local Settings\\Temp\\x509up_u_globus</strong></pre>

    <p>Like the <span class="config-parameter">certLocation</span> and <span class="config-parameter">keyLocation</span> properties, the <span class="config-parameter">certPath</span> and <span class="config-parameter">keyPath</span> properties go together, that is, both <strong>must</strong> be specified (or omitted).  Moreover, both locations and paths <strong>must not</strong> appear in the same configuration file.</p>

    <p>Instead of setting the <span class="config-parameter">certLocation</span> and <span class="config-parameter">keyLocation</span> properties (or <span class="config-parameter">certPath</span> and <span class="config-parameter">keyPath</span> properties) in the SAML Tools configuration file as described above, you could set the <span class="config-parameter">gridshib.certPath</span> and <span class="config-parameter">gridshib.keyPath</span> properties in the low-level bootstrap properties file and let the SAML Tools default to its issuing credential.  See the <a href="install.html#configuration">Configuration</a> section in the Installation Notes for more information.</p>

    <p>As indicated by the above examples, the issuing credential can be an end entity credential or a proxy credential.  The latter gives rise to proxy certificate chains of arbitrary length.  Any proxy certificate in the chain may contain a SAML token.  This is why we recommend you use the GridShib CA for testing, if at all possible.  This leads to some very interesting test scenarios since a GridShib CA-issued end entity credential may itself contain a SAML token.</p>

    <p>See the inline comments in the <a href="http://viewcvs.globus.org/viewcvs.cgi/gridshib/saml/tool/java/etc/gridshib-saml-tools-config.properties?view=log">default configuration properties file</a> for more information about issuing credentials.</p>

    <h3><a name="configuring_saml_issuer">Configuring an identifier for the SAML issuer</a></h3>

    <p>Every SAML entity is assigned a unique identifier called an <code>entityID</code>.  Since the GridShib SAML Assertion Issuer Tool assumes an IdP role, there is an optional configuration property called <span class="config-parameter">IdP.entityID</span> in the properties file.  The Issuer Tool sets the <code>Issuer</code> XML attribute of every issued SAML assertion to the value of the <span class="config-parameter">IdP.entityID</span> property.  If the <span class="config-parameter">IdP.entityID</span> property is omitted, the unique identifier of the SAML Issuer defaults to the X.509 Issuer, that is, the Subject DN of the signing credential (which is precisely what you want in the case of a <code>holder-of-key</code> SAML assertion).</p>

    <p>The format of a SAML <code>entityID</code> is usually a URI.  Where SAML metadata is concerned, the <code>entityID</code> <strong>must</strong> be a URI.  Therefore it is recommended that the <span class="config-parameter">IdP.entityID</span> property be configured as a URI.  For example:</p>

    <pre>  <strong>IdP.entityID=https://gridshib.example.org/idp</strong></pre>

    <p>In the previous example, the <span class="config-parameter">IdP.entityID</span> property has been configured as a URL (which is a kind of URI).  For <code>sender-vouches</code> SAML assertions, it is recommended that the <span class="config-parameter">IdP.entityID</span> property be set to a resolvable URL and that this URL resolve to SAML metadata describing the deployed instance of the SAML Assertion Issuer Tool.</p>

    <blockquote><div style="font-style: italic"><strong>Note:</strong> For issuers of assertions with <code>sender-vouches</code> subject confirmation, SAML metadata will become a required configuration step in a future release of GridShib SAML Tools.</div></blockquote>

    <h3><a name="configuring_saml_nameid">Configuring the SAML name identifier</a></h3>

    <p>Three config file properties determine the syntax of the <code>&lt;saml:NameIdentifier&gt;</code> element of the assertion:</p>

<pre>  <strong>NameID.Format=urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified
  NameID.Format.template=%PRINCIPAL%
  #NameID.NameQualifier=https://idp.example.org/shibboleth</strong></pre>

    <p>For <code>sender-vouches</code> assertions, the <code>NameIdentifier</code> has an unspecified format by default.  Other formats are possible, for example:</p>

<pre>  <strong>NameID.Format=urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName
  NameID.Format.template=uid=%PRINCIPAL%,dc=example,dc=org</strong></pre>

    <p>or</p>

<pre>  <strong>NameID.Format=urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress
  NameID.Format.template=%PRINCIPAL%@example.org</strong></pre>

    <p>Regardless of the format, the Issuer Tool replaces the <code>%PRINCIPAL%</code> placeholder with the user name (i.e., the value of the <span class="command-line-option">--user</span> option) passed to the application on the command line.</p>

    <p>In the case of <code>holder-of-key</code> assertions, the <code>&lt;saml:NameIdentifier&gt;</code> element is set to the subject DN of the user's end entity certificate by default.  To override this behavior, specify the <span class="command-line-option">--user</span> option on the command line and configure the <code>NameID</code> property as outlined above.</p>

    <p>Note: The <span class="config-parameter">NameID.Format</span> and <span class="config-parameter">NameID.Format.template</span> properties go together, that is, both <strong>must</strong> be specified (or omitted).  If one appears in the config file without the other, it is ignored.</p>

    <p>Note: The <span class="config-parameter">NameID.NameQualifier</span> property SHOULD be omitted in most cases (which is why it's commented out in the config file).  However, some relying parties use the <span class="config-parameter">NameID.NameQualifier</span> property for IdP Discovery, so its use may be advisable in certain deployment scenarios.</p>

    <h3><a name="configuring_datetime_pattern">Configuring the dateTime pattern</a></h3>

    <p>The <span class="command-line-option">--authnInstant</span> option takes a <code>dateTime</code> value on the command line (see above for an <a href="#authn-examples">example</a>).  The default format of this <code>dateTime</code> value is given by the following pattern:</p>

    <pre>  <strong>dateTime.pattern=yyyy-MM-dd'T'HH\:mm\:ssZ</strong></pre>

    <p>This line is commented out in the configuration file.  To specify an alternative <code>dateTime</code> pattern, uncomment the above line and modify the pattern to taste:</p>

    <pre>  <strong>dateTime.pattern=yyyy-MM-dd'T'HH\:mm\:ss.SSS'Z'</strong></pre>

    <p>The latter pattern is precisely the pattern used by OpenSAML, but any pattern may be used.  The pattern syntax is identical to that used by the <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/text/SimpleDateFormat.html">SimpleDateFormat</a> Java class.</p>

    <p>Note: For <code>holder-of-key</code> SAML assertions, the <code>dateTime</code> configuration parameter is ignored since the <span class="command-line-option">--authnInstant</span> option is not allowed in this case.</p>

    <h3><a name="configuring_saml_attributes">Configuring SAML attributes</a></h3>

    <p>A single attribute is defined by three properties:</p>

<pre>  <strong>Attribute.<i>label</i>.Namespace=<i>format</i>
  Attribute.<i>label</i>.Name=<i>name</i>
  Attribute.<i>label</i>.Value=<i>value</i></strong></pre>

    <p>where <code style="font-style: italic">name</code> and <code style="font-style: italic">value</code> are the <code>Name</code> and <code>Value</code> of the attribute to be asserted.  The <code style="font-style: italic">label</code> is an arbitrary string that distinguishes a triple <code>(Namespace, Name, Value)</code>.  Any number of such triples are possible, each with its own unique <code style="font-style: italic">label</code>.  Here's an example:</p>

<pre>  <strong>Attribute.mail.Name=urn:mace:dir:attribute-def:mail
  Attribute.mail.Value=trscavo@gmail.com</strong></pre>

    <p>Note that the <code>Namespace</code> property of each attribute is optional.  If omitted, the standard value</p>

<pre>  <strong>Attribute.mail.Namespace=urn:mace:shibboleth:1.0:attributeNamespace:uri</strong></pre>

    <p>is used to construct the SAML <code>Attribute</code>.</p>

    <p>As of Version&nbsp;0.2.0, multi-valued attributes are supported.  To specify multiple values, separate each value by a tab character on the right hand side of the <code>Attribute.<i>label</i>.Value</code> line.</p>

    <h3><a name="configuring_on_the_fly">Configuring the SAML Tools on the command line</a></h3>

    <p>To configure the SAML Tools on-the-fly, a configuration file may be written to disk just-in-time and loaded with the <span class="command-line-option">--config</span> option (a technique we do not illustrate here).  Additionally, the <code>gridshib-saml-issuer</code> tool may be configured on the command line.  For example:</p>

<pre>  UNIX:
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-saml-issuer --user trscavo --holder-of-key \
      --saml --outfile $GRIDSHIB_HOME/testassertion.xml \
      --properties \
        Attribute.mail.Name=urn:oid:0.9.2342.19200300.100.1.3 \
        Attribute.mail.Value=trscavo@gmail.com</strong></pre>

<pre>  Windows:
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-saml-issuer --user trscavo --holder-of-key
      --saml --outfile %GRIDSHIB_HOME%\testassertion.xml
      --properties
        Attribute.mail.Name=urn:oid:0.9.2342.19200300.100.1.3
        Attribute.mail.Value=trscavo@gmail.com</strong></pre>

    <p>The <span class="command-line-option">--properties</span> option takes an arbitrary number of arguments.  Each argument is a name-value pair.  All of the properties discussed in this section are supported and the syntax is exactly the same as that of the configuration properties file.</p>

    <p>Generally, a property configured on the command line overrides a property configured in a config file.  The only exception to this rule is attributes.  Attributes configured on the command line are added to any attributes configured in a config file.</p>

    <h3><a name="configuring_x509_cred_on_the_fly">Configuring the X.509 issuing credential on the command line</a></h3>

    <p>As suggested in the <a href="#configuring_on_the_fly">previous section</a>, the <span class="command-line-option">--properties</span> option can be used to configure the X.509 issuing credential on-the-fly.  For convenience, the <code>gridshib-saml-issuer</code> and <code>gridshib-proxy-bind</code> tools have special command-line options to specify the issuing credential:</p>

<pre>  UNIX:
  $ <strong>$GRIDSHIB_HOME/bin/install-meaningless-eec</strong>
  EEC installed at /tmp/x509up_u504
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-saml-issuer --user trscavo --holder-of-key \
      --saml --outfile $GRIDSHIB_HOME/testassertion.xml \
      --certPath /tmp/x509up_u504 --keyPath /tmp/x509up_u504</strong>
  $ <strong>$GRIDSHIB_HOME/bin/gridshib-proxy-bind \
      --oid 1.3.6.1.4.1.3536.1.1.1.12 \
      --saml --infile $GRIDSHIB_HOME/testassertion.xml \
      --outfile $GRIDSHIB_HOME/testproxy.pem \
      --certPath /tmp/x509up_u504 --keyPath /tmp/x509up_u504</strong></pre>

<pre>  Windows:
  &gt; <strong>%GRIDSHIB_HOME%\bin\install-meaningless-eec</strong>
  EEC installed at C:\DOCUME~1\GLOBUS\LOCALS~1\Temp\x509up_u_globus
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-saml-issuer --user trscavo --holder-of-key
      --saml --outfile %GRIDSHIB_HOME%\testassertion.xml
      --certPath C:\DOCUME~1\GLOBUS\LOCALS~1\Temp\x509up_u_globus
      --keyPath C:\DOCUME~1\GLOBUS\LOCALS~1\Temp\x509up_u_globus</strong>
  &gt; <strong>%GRIDSHIB_HOME%\bin\gridshib-proxy-bind
      --oid 1.3.6.1.4.1.3536.1.1.1.12
      --saml --infile %GRIDSHIB_HOME%\testassertion.xml
      --outfile %GRIDSHIB_HOME%\testproxy.pem
      --certPath C:\DOCUME~1\GLOBUS\LOCALS~1\Temp\x509up_u_globus
      --keyPath C:\DOCUME~1\GLOBUS\LOCALS~1\Temp\x509up_u_globus</strong></pre>

    <p>The <span class="command-line-option">--certPath</span> and <span class="command-line-option">--keyPath</span> options go together, that is, both <strong>must</strong> be specified on the command line (if at all).  If provided, the <span class="command-line-option">--certPath</span> and <span class="command-line-option">--keyPath</span> options override any issuing credential that may configured in a config file.  These options even override an issuing credential specified with the <span class="command-line-option">--properties</span> option on the command line.</p>


    <h2><a name="limitations">Known Limitations</a></h2>

    <p>Known limitations of the GridShib SAML Tools include:</p>

    <ul>
      <li>The SAML Assertion Issuer Tool only supports SAML attribute values of type <code>xsd:string</code>.</li>
      <li>The SAML Attribute Query Client is not fully integrated nor ready for testing.</li>
      <li>The Shibboleth Attribute Resolver is not yet integrated.</li>
    </ul>

    <hr>

    <address>
      The GridShib Project<br>
      <a href="http://gridshib.globus.org/">http://gridshib.globus.org/</a>
    </address>

    <p>
      <a href="http://validator.w3.org/check?uri=referer"><img
         src="http://www.w3.org/Icons/valid-html401"
         alt="Valid HTML 4.01 Strict" height="31" width="88"></a>
    </p>

  </body>

</html>
