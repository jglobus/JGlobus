#!/bin/sh

## the GridShib installation directory
if [ ! -n "$GRIDSHIB_HOME" ] ; then
  echo "Error: GRIDSHIB_HOME is not defined."
  exit 1
fi

## the GridShib base directory
if [ ! -n "$GRIDSHIB_SAML_BASEDIR" ] ; then
  GRIDSHIB_SAML_BASEDIR=$GRIDSHIB_HOME/etc
fi

## is UID defined?
if [ ! -n "$UID" ] ; then
  UID=`grep -i "$USER" /etc/passwd | cut -f 3 -d ":"`
fi

cp $GRIDSHIB_SAML_BASEDIR/meaningless-ca/eec.pem /tmp/x509up_u$UID
cat $GRIDSHIB_SAML_BASEDIR/meaningless-ca/eec-key.pem >> /tmp/x509up_u$UID
chmod 600 /tmp/x509up_u$UID
echo "Meaningless EEC installed at /tmp/x509up_u$UID"
