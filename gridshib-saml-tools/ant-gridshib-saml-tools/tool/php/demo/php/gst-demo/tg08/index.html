<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

  <head>

    <title>GridShib SAML Tools: Demo</title>

    <!-- indexing information for search engines -->
    <meta name="author" lang="en-us" content="Tom Scavo" />
    <meta name="copyright" lang="en-us" content="&copy; 2006&ndash;2008 NCSA" />
    <meta name="keywords" lang="en-us" content="GridShib, SAML, demo, demonstration" />
    <meta name="description" lang="en-us" content="A demonstration of GridShib SAML Tools for TeraGrid Science Gateway developers" />

    <!-- server response header entries -->
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
    <meta http-equiv="Content-Script-Type" content="text/javascript" />
    <meta http-equiv="Content-Style-Type" content="text/css" />

    <!-- local styles -->
    <style type="text/css">
      ol ol { list-style-type: lower-alpha; }
      a:link img { border: 0 }
      a:visited img { border: 0 }
      a:active img { border: 0 }
      legend { font-size: larger }
    </style>

    <script type="text/javascript">
      window.onload =
        function() {
          document.forms[0].username.value = "trscavo";
          document.forms[0].attribute_mail_value.value = "trscavo@gmail.com";
        }
      function doSubmit() {
        return true;
      }
      function doNotSubmit() {
        window.alert("Not yet implemented!");
        return false;
      }
    </script>

  </head>

  <body>

    <h1>GridShib SAML Tools</h1>

    <p>This is a demo of the <a href="http://gridshib.globus.org/download.html#saml-tools">GridShib SAML Tools</a> for TeraGrid Science Gateway developers.  We use the GridShib SAML Assertion Issuer command-line tool (<code>gridshib-saml-issuer</code>) on the server to issue an X.509-bound SAML token.  A Java portal could do the same thing (but even easier) using the provided Java API.</p>

    <form method="get" action="/insecure/issuer.php" onsubmit="return doSubmit()">

      <fieldset style="margin-bottom: 2ex" id="portal_login">
        <legend>Simulated portal login</legend>
        <table cellspacing="0" cellpadding="2">
          <tr>
            <td colspan="2"><em>Enter your login credentials:</em></td>
          </tr>
          <tr>
            <td align="right"><strong>Username:</strong></td>
            <td>
              <label title="Enter your username">
                <input type="text" name="username" id="username" size="25" />
              </label>
            </td>
          </tr>
          <tr>
            <td align="right"><strong>Password:</strong></td>
            <td>
              <label title="Enter your password">
                (not required for this demo)
              </label>
            </td>
          </tr>
        </table>
        <p>
          <em>Output options:</em>
          <label title="Push this button for X.509 plus SAML">
            <br />
            <input type="radio" name="outfile_type" id="outfile_x509" value="X509" />&nbsp;Issue X.509 proxy certificate with bound SAML token
          </label>
          <label title="Push this button for SAML only">
            <br />
            <input type="radio" name="outfile_type" id="outfile_saml" value="SAML" checked="checked" />&nbsp;Issue SAML token only
          </label>
        </p>
        <p>
          <label title="Login to the SAML Assertion Issuer Tool">
            <input type="submit" value="Login" />
          </label>
        </p>
      </fieldset>

      <p>The <code>username</code> is a critical input into the SAML production process.  As seen below, it gives rise to a globally unique name identifier that is baked into the SAML token.</p>

      <p>If you choose the SAML output option, an XML blob will be
      returned to your browser.  Choosing the X.509 output option,
      on the other hand, causes the SAML to be bound to an X.509 proxy
      certificate, which is filtered through openssl for viewing in
      your browser.</p>

      <fieldset style="margin-bottom: 2ex" id="config_properties">
        <legend>Information from config file</legend>
        <table cellspacing="0" cellpadding="2">
          <tr>
            <td align="right"><strong><code>IdP.entityID</code>:</strong></td>
            <td>
              <label title="This is the gateway's unique SAML identifier">
                <code>https://gridshib.example.org/idp</code>
                <input type="hidden" name="entityID" id="entityID"
                       value="https://gridshib.example.org/idp" />
              </label>
            </td>
          </tr>
          <tr>
            <td align="right"><strong><code>NameID.Format</code>:</strong></td>
            <td>
              <label title="This is the format of the SAML name identifier">
                <code>urn:oid:1.3.6.1.4.1.5923.1.1.1.6</code>
                <input type="hidden" name="nameid_format" id="nameid_format"
                       value="urn:oid:1.3.6.1.4.1.5923.1.1.1.6" />
              </label>
            </td>
          </tr>
          <tr>
            <td align="right"><strong><code>NameID.Format.template</code>:</strong></td>
            <td>
              <label title="This is the formatting template of the SAML name identifier">
                <code>%PRINCIPAL%@example.org</code>
                <input type="hidden" name="nameid_format_template" id="nameid-format-template"
                       value="%PRINCIPAL%@example.org" />
              </label>
            </td>
          </tr>
          <tr>
            <td align="right"><strong><code>Attribute.isMemberOf.Name</code>:</strong></td>
            <td>
              <label title="This is the name of the isMemberOf attribute">
                <code>urn:oid:1.3.6.1.4.1.5923.1.5.1.1</code>
                <input type="hidden" name="attribute_ismemberof_name" id="attribute_ismemberof_name"
                       value="urn:oid:1.3.6.1.4.1.5923.1.5.1.1" />
              </label>
            </td>
          </tr>
          <tr>
            <td align="right"><strong><code>Attribute.isMemberOf.Value</code>:</strong></td>
            <td>
              <label title="This is the value of the isMemberOf attribute">
                <code>group://example.org/example</code>
                <input type="hidden" name="attribute_ismemberof_value" id="attribute_ismemberof_value"
                       value="group://example.org/example" />
              </label>
            </td>
          </tr>
        </table>
      </fieldset>

      <p>These config properties are configured once-and-for-all in a static config properties file.  The configured values may be overridden on the command line or via the Java API.</p>

      <p>The <code>IdP.entityID</code> is the globally unique name of the SAML issuer.  TeraGrid will assign an <code>entityID</code> to each gateway.  Note that the <code>entityID</code> is a URI, which need not be a resolvable URL.  That said, future versions of GridShib may take advantage of this fact.</p>

      <p>Note the <em>scope</em> value (<code>example.org</code>) used in <code>NameID.Format.template</code> and <code>Attribute.isMemberOf.Value</code>.  The two scope values must match.  For uniqueness, we recommend that a gateway use its DNS domain name as its scope value.</p>

      <fieldset style="margin-bottom: 2ex" id="command_line_options">
        <legend>Information computed at runtime</legend>
        <table cellspacing="0" cellpadding="2">
          <tr>
            <td align="right"><strong><code>authnMethod</code>:</strong></td>
            <td>
              <label title="This is the authentication method associated with the authenticated user">
                <code>urn:oasis:names:tc:SAML:1.0:am:password</code>
                <input type="hidden" name="authnMethod" id="authnMethod"
                       value="urn:oasis:names:tc:SAML:1.0:am:password" />
              </label>
            </td>
          </tr>
          <tr>
            <td align="right"><strong><code>authnInstant</code>:</strong></td>
            <td>
              <label title="This is the authentication instant associated with the authenticated user">
                <code>2007-08-02T12:10:34-0400</code>
                <input type="hidden" name="authnInstant" id="authnInstant"
                       value="2007-08-02T12:10:34-0400" />
              </label>
            </td>
          </tr>
          <tr>
            <td align="right"><strong><code>address</code>:</strong></td>
            <td>
              <label title="This is the IP address of the authenticated user">
                <code>255.255.255.255</code>
                <input type="hidden" name="address" id="address"
                       value="255.255.255.255" />
              </label>
            </td>
          </tr>
          <tr>
            <td align="right"><strong><code>Attribute.mail.Name</code>:</strong></td>
            <td>
              <label title="This is the name of the mail attribute">
                <code>urn:oid:0.9.2342.19200300.100.1.3</code>
                <input type="hidden" name="attribute_mail_name" id="attribute_mail_name"
                       value="urn:oid:0.9.2342.19200300.100.1.3" />
              </label>
            </td>
          </tr>
          <tr>
            <td align="right"><strong><code>Attribute.mail.Value</code>:</strong></td>
            <td>
              <label title="This is the value of the mail attribute">
                <input type="text" name="attribute_mail_value" id="attribute_mail_value" size="35" />
              </label>
            </td>
          </tr>
        </table>
      </fieldset>

      <p>Some information is determined at runtime, for each user request.  For instance, the method used to authenticate the user (<code>authnMethod</code>) must be provided by the gateway developer.  (For most gateway deployments, this is a fixed URI.)  The authentication instant (<code>authnInstant</code>) and the IP address (<code>address</code>) are also computed by the gateway developer on-the-fly on the server side.  Determining the values of <code>authnInstant</code> and <code>address</code> can be tricky, however.</p>

    </form>

    <p>
      For the purposes of this demo, a PHP script on the server side performs the following steps:
    </p>
    <ol>
      <li>The HTTP parameters in this web form are extracted from the HTTP request and plugged into a GridShib SAML Tools configuration file template.</li>
      <li>The configuration file is written out to disk.</li>
      <li>The <code>gridshib-saml-issuer</code> tool is invoked.  The tool issues a SAML assertion according to the configuration file written to disk previously.</li>
      <li>The name identifier in the assertion is the value of the <code>username</code> field, substituted into the <code>NameID.Format.template</code> read from the config file.</li>
      <li>If the user requested X.509 output, the tool binds the SAML assertion to an X.509 proxy certificate, parses the certificate with <code>openssl</code>, and returns the result to the browser.  Otherwise, the tool returns the issued SAML assertion directly to the browser.</li>
    </ol>

    <hr />

    <p>
      <a href="http://validator.w3.org/check?uri=referer"><img
         src="../../images/valid-xhtml10.png"
         alt="Valid XHTML 1.0 Strict" height="31" width="88" /></a>
    </p>

  </body>

</html>
